# Dart 字符串插值详解

## 基本概念

在 Dart 中，字符串插值（String Interpolation）是一种将变量或表达式的值插入到字符串中的方法。

## 语法规则

### 1. 简单变量插值：`$变量名`

**语法**：`$变量名`

**示例**：
```dart
int counter = 5;
String message = 'Count: $counter';  // 结果：'Count: 5'
```

**你的代码**：
```dart
int _counter = 0;
Text('$_counter')  // 显示：0
```

### 2. 表达式插值：`${表达式}`

**语法**：`${表达式}`

**示例**：
```dart
int a = 5;
int b = 3;
String result = 'Sum: ${a + b}';  // 结果：'Sum: 8'

String name = 'Flutter';
String greeting = 'Hello ${name.toUpperCase()}';  // 结果：'Hello FLUTTER'
```

## 详细说明

### `$_counter` 的含义

```dart
int _counter = 0;

// ✅ 正确：使用 $ 符号进行字符串插值
Text('$_counter')  // 显示：0

// ❌ 错误：不使用 $ 符号
Text('_counter')   // 显示：_counter（字面量字符串）
```

**解释**：
- `$_counter` 中的 `$` 是**固定写法**，表示字符串插值
- `_counter` 是变量名
- 整个 `$_counter` 会被替换为变量的**值**（比如 0, 1, 2...）

### 为什么需要 `$` 符号？

`$` 符号告诉 Dart 编译器：
- "这不是普通文本，而是变量"
- "请将变量的值插入到这里"

## 常见用法

### 1. 简单变量

```dart
String name = 'Flutter';
print('Hello $name');  // 输出：Hello Flutter

int age = 25;
print('Age: $age');    // 输出：Age: 25
```

### 2. 对象属性

```dart
class Person {
  String name = 'Alice';
}

Person person = Person();
print('Name: ${person.name}');  // 需要使用 ${} 因为包含点号
```

### 3. 表达式

```dart
int a = 10;
int b = 20;
print('Sum: ${a + b}');           // 输出：Sum: 30
print('Double: ${a * 2}');        // 输出：Double: 20
print('Is even: ${a % 2 == 0}'); // 输出：Is even: true
```

### 4. 方法调用

```dart
String text = 'hello';
print('Uppercase: ${text.toUpperCase()}');  // 输出：Uppercase: HELLO

List<int> numbers = [1, 2, 3];
print('Length: ${numbers.length}');  // 输出：Length: 3
```

### 5. 条件表达式

```dart
bool isLoggedIn = true;
print('Status: ${isLoggedIn ? "Logged in" : "Not logged in"}');
// 输出：Status: Logged in
```

## 什么时候用 `$` 还是 `${}`？

### 使用 `$变量名` 的情况

**规则**：变量名后面紧跟的是**非字母数字字符**（如空格、标点、换行等）

```dart
int count = 5;
String name = 'Flutter';

// ✅ 正确
'Count: $count'        // 空格后
'Hello $name!'         // 感叹号前
'$name is great'        // 空格前

// ❌ 错误（会编译错误）
'$countitems'           // 变量名会被识别为 countitems
```

### 使用 `${表达式}` 的情况

**规则**：需要访问属性、调用方法、或使用表达式时

```dart
// ✅ 必须使用 ${}
'${person.name}'        // 访问属性
'${list.length}'        // 访问属性
'${text.toUpperCase()}' // 调用方法
'${a + b}'              // 表达式
'${count}items'         // 避免变量名混淆
```

## 实际示例对比

### 示例 1：你的代码

```dart
int _counter = 0;

// 显示计数器值
Text('$_counter')  // ✅ 正确：显示 0, 1, 2...

// 如果不用 $ 符号
Text('_counter')   // ❌ 错误：显示字面量 "_counter"
```

### 示例 2：复杂情况

```dart
int count = 5;
String item = 'apples';

// ✅ 简单变量
'Count: $count'                    // Count: 5

// ✅ 需要 ${} 因为后面紧跟字母
'$count items'                     // 5 items（但可能混淆）
'${count}items'                    // 5items（更清晰）

// ✅ 表达式
'Total: ${count * 2}'              // Total: 10

// ✅ 方法调用
'Uppercase: ${item.toUpperCase()}' // Uppercase: APPLES
```

## 常见错误

### 错误 1：忘记 `$` 符号

```dart
int count = 5;
print('Count: count');  // ❌ 输出：Count: count（字面量）
print('Count: $count'); // ✅ 输出：Count: 5
```

### 错误 2：变量名混淆

```dart
int count = 5;
print('$countitems');   // ❌ 错误：找不到 countitems 变量
print('${count}items'); // ✅ 正确：5items
```

### 错误 3：属性访问不用 `${}`

```dart
class Person {
  String name = 'Alice';
}

Person p = Person();
print('Name: $p.name');   // ❌ 错误：会尝试找 p.name 变量
print('Name: ${p.name}'); // ✅ 正确：Name: Alice
```

## 总结

| 语法 | 用途 | 示例 |
|------|------|------|
| `$变量名` | 简单变量插值 | `'Count: $count'` |
| `${表达式}` | 表达式、属性、方法 | `'Sum: ${a + b}'` |
| `${变量名}` | 避免变量名混淆 | `'${count}items'` |

**关键点**：
- ✅ `$` 是**固定写法**，表示字符串插值
- ✅ `$_counter` 表示取变量 `_counter` 的值
- ✅ 简单变量用 `$变量名`
- ✅ 表达式/属性/方法用 `${表达式}`
- ✅ 当变量名后紧跟字母时，用 `${}` 避免混淆

